import { StandardState, StatusType } from '@c2pkg/statemachine';
import { Init, Provide, Scope, ScopeEnum } from '@midwayjs/core';
import { <%= PascalCase %>Bsc } from '../entity';
import { LgCommonStateMachine } from './lgCommonStatemachine';

export enum <%= PascalCase %>StateEnum {}

export class <%= PascalCase %>State extends StandardState {
  stateCode: string;
  constructor(
    stateCode: string,
    label: string,
    status: StatusType,
    customizable = false
  ) {
    super(stateCode as string, label, status, customizable);
  }
}

/**
 * <%= label %>状态机
 */
@Provide()
@Scope(ScopeEnum.Singleton)
export class <%= PascalCase %>StateMachine extends LgCommonStateMachine {
  bizmetaKey = <%= PascalCase %>Bsc.BIZMETA_KEY;

  @Init()
  async init() {
    super.init();
    super.initCommonStates();
    this.declareExtraStates();
  }

  declareExtraStates() {
    this.createdState.addActions([
      'deleteFull<%= PascalCase %>Bsc',
      'updateFull<%= PascalCase %>Bsc',
      'update<%= PascalCase %>Bsc',
      'update<%= PascalCase %>Dt',
      //'update<%= PascalCase %>Wh',
      'recycle<%= PascalCase %>Bsc',
      'save<%= PascalCase %>Bsc',
    ]);

    this.cusSavedState.addActions([
      'deleteSaved<%= PascalCase %>Bsc',
      'declare<%= PascalCase %>Bsc',
    ]);

    this.cusDeclaredState.addActions(['revoke<%= PascalCase %>Bsc']);
  }
}
